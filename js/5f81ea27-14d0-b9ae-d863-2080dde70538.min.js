/* Minifyed by 13ninstudio, Inc */ let seven=null;async function init7z(){seven||(seven=await SevenZip(),await seven.loadWasm("https://cdn.jsdelivr.net/npm/7z-wasm@latest/7zz.wasm"))}function uint8ToBase64(e){let t=0,n="";for(;t<e.length;)n+=String.fromCharCode.apply(null,e.subarray(t,t+32768)),t+=32768;return btoa(n)}function base64ToUint8(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}init7z();const inputText=document.getElementById("inputText"),btn7z=document.getElementById("btn7z"),btn7zDownload=document.getElementById("btn7zDownload"),outBase64=document.getElementById("outBase64"),inputSizeEl=document.getElementById("inputSize"),compressedSizeEl=document.getElementById("compressedSize"),levelSel=document.getElementById("level"),sevenFileInput=document.getElementById("sevenFile"),btnUn7zFile=document.getElementById("btnUn7zFile"),btnUn7zFileDownload=document.getElementById("btnUn7zFileDownload"),btnUn7zFromBase64=document.getElementById("btnUn7zFromBase64"),outText=document.getElementById("outText");function updateInputSize(){const e=(new TextEncoder).encode(inputText.value).length;inputSizeEl.textContent=e}async function do7z(e,t=6){await init7z(),seven.FS.writeFile("data.txt",(new TextEncoder).encode(e)),seven.callMain(["a","-t7z",`-mx=${t}`,"out.7z","data.txt"]);const n=seven.FS.readFile("out.7z");return seven.FS.unlink("data.txt"),seven.FS.unlink("out.7z"),n}updateInputSize(),inputText.addEventListener("input",updateInputSize),btn7z.addEventListener("click",(async()=>{const e=inputText.value,t=levelSel.value,n=await do7z(e,t);outBase64.value=uint8ToBase64(n),compressedSizeEl.textContent=n.length})),btn7zDownload.addEventListener("click",(async()=>{const e=inputText.value,t=levelSel.value,n=await do7z(e,t),a=new Blob([n],{type:"application/x-7z-compressed"}),i=URL.createObjectURL(a),l=document.createElement("a");l.href=i,l.download="data.7z",l.click(),setTimeout((()=>URL.revokeObjectURL(i)),3e3)}));let lastLoadedUint8=null;async function extract7z(e){await init7z(),seven.FS.writeFile("in.7z",e),seven.callMain(["x","in.7z","-y"]);const t=seven.FS.readdir(".").filter((e=>"."!==e&&".."!==e&&"in.7z"!==e));if(0===t.length)return"";const n=t[0],a=seven.FS.readFile(n);return seven.FS.unlink("in.7z"),seven.FS.unlink(n),(new TextDecoder).decode(a)}sevenFileInput.addEventListener("change",(async e=>{const t=e.target.files?.[0];t&&(lastLoadedUint8=new Uint8Array(await t.arrayBuffer()),alert("7z ファイルを読み込みました。"))})),btnUn7zFile.addEventListener("click",(async()=>{if(!lastLoadedUint8)return alert("まず 7z ファイルを選択してください");outText.value=await extract7z(lastLoadedUint8)})),btnUn7zFileDownload.addEventListener("click",(async()=>{if(!lastLoadedUint8)return alert("まず 7z ファイルを選択してください");await init7z(),seven.FS.writeFile("in.7z",lastLoadedUint8),seven.callMain(["x","in.7z","-y"]);const e=seven.FS.readdir(".").filter((e=>"."!==e&&".."!==e&&"in.7z"!==e))[0],t=seven.FS.readFile(e),n=new Blob([t],{type:"application/octet-stream"}),a=URL.createObjectURL(n),i=document.createElement("a");i.href=a,i.download=e,i.click(),setTimeout((()=>URL.revokeObjectURL(a)),3e3),seven.FS.unlink("in.7z"),seven.FS.unlink(e)})),btnUn7zFromBase64.addEventListener("click",(async()=>{const e=outBase64.value.trim();if(!e)return alert("Base64 を入力してください");outText.value=await extract7z(base64ToUint8(e))}));